<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>글 상세</title>
    <style>
        body {
            text-align: center;
        }

        table {
            border-collapse: collapse;
            width: 700px;
            margin: auto;
            margin-top: 20px; /* 상단 마진 추가 */
        }
        
        .edit-form {
        	display: none;
        	margin-top: 10px;
    	}
    </style>
    
    <script>
    function toggleEditForm(replyId) {
        var editForm = document.getElementById('edit-form-' + replyId);
        editForm.style.display = (editForm.style.display === 'none') ? 'block' : 'none';
    }
</script>

</head>
<body>
    <div th:replace="~{fragments/header}"></div>	

    <form th:action="@{/updateBoard}" method="post">
        <input type="hidden" name="bseq" th:value="${board.bseq}" />
        <table border="1" cellpadding="0" cellspacing="0">
            <tr>
                <td bgcolor="#f2f2f2" width="70" style="color: black;">제목</td>
                <td align="left" bgcolor="#f2f2f2"><input type="text" name="btitle" th:value="${board.btitle}" /></td>
            </tr>
            <tr>
                <td bgcolor="#f9f9f9" style="color: black;">작성자</td>
                <td align="left" bgcolor="#f9f9f9" th:text="${board.member.id}"></td>
            </tr>
            <tr>
                <td bgcolor="#f2f2f2" style="color: black;">내용</td>
                <td align="left" bgcolor="#f2f2f2"><textarea name="bcontent" cols="40" rows="10" th:text="${board.bcontent}"></textarea></td>
            </tr>
            <tr>
                <td bgcolor="#f9f9f9" style="color: black;">등록일</td>
                <td align="left" bgcolor="#f9f9f9"><span th:text="${#dates.format(board.createDate, 'yyyy-MM-dd')}"></span></td>
            </tr>
            <tr>
                <td bgcolor="#f2f2f2" style="color: black;">조회수</td>
                <td align="left" bgcolor="#f2f2f2" th:text="${board.cnt}"></td>
            </tr>
            <tr>
                <td bgcolor="#f9f9f9" colspan="2" align="center">
                    <input type="submit" value="글 수정"/>
                </td>
            </tr>
            <tr>
                <td bgcolor="#f2f2f2" colspan="2" align="center">
                    <!-- 수정: 글 삭제 링크에 경고 메시지 및 비밀번호 확인 추가 -->
                    <a th:href="@{/deleteBoard(bseq=${board.bseq})}" style="color: black;">글삭제</a>&nbsp;&nbsp;&nbsp;
                    <a th:href="@{/getBoardList}" style="color: black;">글목록</a>
                </td>
            </tr>
        </table>
    </form> 
    
<!-- 댓글 목록 표시 -->
<div style="margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px;">
    <h2 style="color: #333;">댓글 목록</h2>
    <ul style="list-style: none; padding: 0;">
        <li th:each="reply : ${board.replies}" style="margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; position: relative;">
            <p th:text="${reply.rcontent}" style="margin-bottom: 5px; font-size: 14px;"></p>
            <small th:text="${'작성자 ID: ' + reply.member.id}" style="color: #888; font-size: 12px;"></small>

            <!-- 수정 폼 -->
            <form id="edit-form-${reply.rseq}" th:action="@{/reply/update}" method="post" class="edit-form" style="display: none;">
                <input type="hidden" name="rseq" th:value="${reply.rseq}" />
                <input type="hidden" name="boardBseq" th:value="${board.bseq}" />
                <textarea name="content" rows="3" cols="40" th:text="${reply.rcontent}"></textarea>
                <input type="submit" value="수정" />
            </form>

            <!-- 수정 및 삭제 버튼 영역 -->
            <div style="position: absolute; top: 5px; right: 5px;">

                <!-- 수정 버튼 -->
                <button onclick="toggleEditForm('${reply.rseq}')" style="color: #007bff; font-size: 12px; background: none; border: none; cursor: pointer;">수정</button>

                <!-- 댓글 삭제 폼 추가 -->
                <form th:action="@{/reply/delete/{rseq}(rseq=${reply.rseq}, boardBseq=${board.bseq})}" method="post" style="display: inline;">
                    <input type="submit" value="삭제" style="color: red; font-size: 12px; background: none; border: none; cursor: pointer;">
                </form>

            </div>
        </li>
    </ul>
</div>




<!-- 댓글 입력 폼 -->
<form th:action="@{/reply/add}" method="post" style="margin-top: 20px; border-top: 1px solid #ccc; padding-top: 20px;">
    <input type="hidden" name="boardBseq" th:value="${board.bseq}" />
    <textarea name="content" rows="3" cols="40" placeholder="댓글을 입력하세요" style="width: 100%; margin-bottom: 10px;"></textarea>
    <input type="submit" value="댓글 등록" style="padding: 8px 16px; background-color: f2f2f2; color: black; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;" />
</form>
 

    <div th:replace="~{fragments/footer}"></div>
</body>
</html>
